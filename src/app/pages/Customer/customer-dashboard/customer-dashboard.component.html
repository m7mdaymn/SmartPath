<!-- customer-dashboard.component.html -->
<div class="customer-dashboard" dir="rtl">
  <!-- Premium Header -->
  <header class="dashboard-header">
    <div class="header-container">
      <div class="user-section">
        <div class="avatar-container">
          <img [src]="user.avatar" alt="ุตูุฑุฉ ุงูููู ุงูุดุฎุตู" class="user-avatar">
          <span class="online-status"></span>
        </div>
        <div class="user-info">
          <h1 class="user-greeting">ูุฑุญุจุงู ุจูุ {{ user.name }}</h1>
          <p class="user-details">{{ user.email }} โข ุนุถู ููุฐ 6 ุฃุดูุฑ</p>
        </div>
        <div class="header-stats">
          <div class="mini-stat">
            <span class="mini-icon">๐</span>
            <div>
              <span class="mini-value">{{ stats.rewardsEarned }}</span>
              <span class="mini-label">ููุทุฉ</span>
            </div>
          </div>
          <div class="mini-stat">
            <span class="mini-icon">๐</span>
            <div>
              <span class="mini-value">{{ stats.totalWashes }}</span>
              <span class="mini-label">ุบุณูุฉ</span>
            </div>
          </div>
        </div>
      </div>

      <div class="header-actions">
        <button (click)="logout()" class="logout-btn">
          <span class="btn-icon">๐ช</span>
          ุชุณุฌูู ุงูุฎุฑูุฌ
        </button>
      </div>
    </div>
  </header>

  <!-- Quick Stats Overview -->
  <section class="stats-overview" @fadeIn>
    <div class="section-header">
      <h2>ูุธุฑุฉ ุณุฑูุนุฉ</h2>
      <p>ุฅุญุตุงุฆูุงุช ุญุณุงุจู ุงููุงููุฉ</p>
    </div>

    <div class="stats-grid">
      <!-- Total Washes Card -->
      <div class="stat-card" [@cardAnimation]>
        <div class="card-icon washes">๐</div>
        <div class="card-content">
          <h3>ุฅุฌูุงูู ุงูุบุณูุงุช</h3>
          <div class="stat-number">{{ stats.totalWashes }}</div>
          <div class="stat-trend positive">
            <span>+12 ูุฐุง ุงูุดูุฑ</span>
            <span class="trend-icon">๐</span>
          </div>
        </div>
        <div class="card-badge">ุงูุฃูุดุทุฉ</div>
      </div>

      <!-- Total Spent Card -->
      <div class="stat-card" [@cardAnimation]>
        <div class="card-icon spent">๐ฐ</div>
        <div class="card-content">
          <h3>ุฅุฌูุงูู ุงูุฅููุงู</h3>
          <div class="stat-number">{{ stats.totalSpent | number }} <span class="currency">ุฑูุงู</span></div>
          <div class="stat-details">
            <span>ูุชูุณุท: 50 ุฑูุงู/ุบุณูุฉ</span>
          </div>
        </div>
        <div class="card-badge">ุงููุงููุฉ</div>
      </div>

      <!-- Rewards Earned Card -->
      <div class="stat-card" [@cardAnimation]>
        <div class="card-icon rewards">๐</div>
        <div class="card-content">
          <h3>ุงูููุงุท ุงูููุชุณุจุฉ</h3>
          <div class="stat-number">{{ stats.rewardsEarned | number }}</div>
          <div class="progress-section">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="65"></div>
            </div>
            <span class="progress-text">65% ูุญู ุงููุณุชูู ุงูุชุงูู</span>
          </div>
        </div>
        <div class="card-badge">ุงูููุงูุขุช</div>
      </div>

      <!-- Wallet Balance Card -->
      <div class="stat-card wallet-highlight" [@cardAnimation]>
        <div class="card-icon wallet">๐ณ</div>
        <div class="card-content">
          <h3>ุฑุตูุฏ ุงููุญูุธุฉ</h3>
          <div class="stat-number">{{ wallet.balance }} <span class="currency">ุฑูุงู</span></div>
          <div class="wallet-actions">
            <button (click)="viewWallet()" class="wallet-action-btn">
              <span class="action-icon">โ</span>
              ุฅุถุงูุฉ ุฑุตูุฏ
            </button>
            <button (click)="viewWallet()" class="wallet-action-btn outline">
              <span class="action-icon">๐</span>
              ุงูุชูุงุตูู
            </button>
          </div>
        </div>
        <div class="card-badge premium">ูุชุงุญ</div>
      </div>
    </div>
  </section>

  <!-- Main Content Grid -->
  <div class="main-content">
    <!-- Left Column: Quick Actions & Loyalty Cards -->
    <div class="content-column">
      <!-- Quick Actions -->
      <section class="quick-actions-section">
        <div class="section-header">
          <h3>ุงูุฅุฌุฑุงุกุงุช ุงูุณุฑูุนุฉ</h3>
          <p>ุงููู ุจูู ุตูุญุงุช ุญุณุงุจู ุจุณูููุฉ</p>
        </div>
        <div class="actions-grid">
          <a *ngFor="let action of quickActions" 
             [routerLink]="action.route" 
             class="quick-action-card"
             [style.--action-color]="action.color">
            <div class="action-icon" [style.background]="action.color + '20'">
              <span>{{ action.icon }}</span>
            </div>
            <h4>{{ action.label }}</h4>
            <p>{{ action.description }}</p>
          </a>
        </div>
      </section>

      <!-- Loyalty Cards -->
      <section class="loyalty-cards-section">
        <div class="section-header">
          <div>
            <h3>ุจุทุงูุงุช ุงูููุงุก</h3>
            <p>ุชุชุจุน ุชูุฏูู ูุน ูุบุงุณูู ุงูููุถูุฉ</p>
          </div>
          <button (click)="viewAllLoyaltyCards()" class="view-all-btn">
            ุนุฑุถ ุงููู โ
          </button>
        </div>
        <div class="loyalty-cards-container">
          <div *ngFor="let card of loyaltyCards" 
               class="loyalty-card"
               [style.background]="card.cardColor"
               (click)="showQRCode(card)">
            <div class="card-glow"></div>
            <div class="card-content">
              <div class="card-header">
                <h4>{{ card.merchant }}</h4>
                <div class="card-chip">VIP</div>
              </div>
              <div class="card-progress">
                <div class="progress-info">
                  <span class="progress-label">ุชูุฏู ุงูุจุฑูุงูุฌ</span>
                  <span class="progress-value">{{ card.progress }}%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="card.progress"></div>
                </div>
                <div class="progress-stats">
                  <span>{{ card.washesCompleted }}/{{ card.washesRequired }} ุบุณูุงุช</span>
                  <span class="expiry-date">โณ {{ card.expiryDate }}</span>
                </div>
              </div>
              <button class="qr-scan-btn" (click)="$event.stopPropagation(); showQRCode(card)">
                <span class="qr-icon">๐ฑ</span>
                ูุณุญ ุงูุจุทุงูุฉ
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Recent Washes -->
      <section class="recent-washes-section">
        <div class="section-header">
          <h3>ุขุฎุฑ ุงูุบุณูุงุช</h3>
          <p>ุณุฌู ูุดุงุทู ุงูุฃุฎูุฑ</p>
        </div>
        <div class="washes-table">
          <div class="table-header">
            <span>ุงูุชุงุฑูุฎ</span>
            <span>ุงููููุน</span>
            <span>ุงูููุน</span>
            <span>ุงูุญุงูุฉ</span>
            <span>ุงููุจูุบ</span>
          </div>
          <div class="washes-list">
            <div *ngFor="let wash of recentWashes" 
                 class="wash-row"
                 [ngClass]="'status-' + wash.status">
              <span class="wash-date">{{ wash.date }}</span>
              <span class="wash-location">{{ wash.location }}</span>
              <span class="wash-type">{{ wash.type }}</span>
              <span class="wash-status">
                <span class="status-badge" [ngClass]="'badge-' + wash.status">
                  {{ getStatusText(wash.status) }}
                </span>
              </span>
              <span class="wash-price">{{ wash.price }} ุฑูุงู</span>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Right Column: Rewards & Transactions -->
    <div class="content-column">
      <!-- Available Rewards -->
      <section class="rewards-section">
        <div class="section-header">
          <h3>ุงูููุงูุขุช ุงููุชุงุญุฉ</h3>
          <p>ุงุณุชุจุฏู ููุงุทู ุจููุงูุขุช ุญุตุฑูุฉ</p>
        </div>
        <div class="rewards-container">
          <div *ngFor="let reward of availableRewards" class="reward-card">
            <div class="reward-header">
              <div class="reward-icon">{{ reward.icon }}</div>
              <div class="reward-titles">
                <h4>{{ reward.name }}</h4>
                <p class="reward-merchant">{{ reward.merchant }}</p>
              </div>
            </div>
            <p class="reward-description">{{ reward.description }}</p>
            <div class="reward-progress">
              <div class="points-info">
                <span class="points-current">{{ reward.currentPoints }}</span>
                <span class="points-separator">/</span>
                <span class="points-required">{{ reward.pointsRequired }} ููุทุฉ</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width.%]="(reward.currentPoints / reward.pointsRequired) * 100"></div>
              </div>
            </div>
            <div class="reward-footer">
              <span class="expiry-text">โณ ููุชูู {{ reward.expiryDate }}</span>
              <button (click)="redeemReward(reward)" 
                      [disabled]="reward.currentPoints < reward.pointsRequired"
                      class="redeem-btn"
                      [ngClass]="{ 'available': reward.currentPoints >= reward.pointsRequired }">
                {{ reward.currentPoints >= reward.pointsRequired ? 'ุงุณุชุจุฏุงู ุงูุขู' : 'ููุงุท ุบูุฑ ูุงููุฉ' }}
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Wallet Transactions -->
      <section class="transactions-section">
        <div class="section-header">
          <h3>ุขุฎุฑ ุงููุนุงููุงุช</h3>
          <p>ุญุฑูุฉ ูุญูุธุชู ุงููุงููุฉ</p>
        </div>
        <div class="transactions-container">
          <div *ngFor="let transaction of walletTransactions" class="transaction-item">
            <div class="transaction-icon" [ngClass]="transaction.type">
              <span>{{ transaction.type === 'credit' ? 'โฌ๏ธ' : 'โฌ๏ธ' }}</span>
            </div>
            <div class="transaction-details">
              <h4>{{ transaction.description }}</h4>
              <p class="transaction-date">{{ transaction.date }}</p>
            </div>
            <div class="transaction-amount" [ngClass]="transaction.type">
              <span class="amount">{{ transaction.type === 'credit' ? '+' : '-' }}{{ transaction.amount }} ุฑูุงู</span>
              <span class="balance">ุงูุฑุตูุฏ: {{ transaction.balance }} ุฑูุงู</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Favorite Merchant -->
      <section class="favorite-merchant-section">
        <div class="section-header">
          <h3>ุงููุบุณูุฉ ุงูููุถูุฉ</h3>
          <p>ุฃูุซุฑ ููุงู ุชุฒูุฑู</p>
        </div>
        <div class="favorite-card">
          <div class="merchant-info">
            <div class="merchant-avatar">๐</div>
            <div class="merchant-details">
              <h4>{{ stats.favoriteMerchant }}</h4>
              <p>12 ุฒูุงุฑุฉ ูุฐุง ุงูุดูุฑ</p>
            </div>
          </div>
          <div class="merchant-stats">
            <div class="stat">
              <span class="stat-value">45%</span>
              <span class="stat-label">ูู ุบุณูุงุชู</span>
            </div>
            <div class="stat">
              <span class="stat-value">4.8</span>
              <span class="stat-label">ุชููููู</span>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- QR Code Modal -->
  <div *ngIf="showQRModal" class="qr-modal" (click)="closeQRModal()">
    <div class="modal-content" (click)="$event.stopPropagation()" @modalAnimation>
      <button class="modal-close" (click)="closeQRModal()">
        <span>โ</span>
      </button>
      
      <div class="modal-header">
        <h3>{{ selectedCard?.merchant }}</h3>
        <p class="modal-subtitle">ูุณุญ ุงูุจุทุงูุฉ ุนูุฏ ูุตููู ูููุบุณูุฉ</p>
      </div>

      <div class="qr-display">
        <div class="qr-code-container">
          <div class="qr-code">
            <div class="qr-pattern">
              <!-- QR Code Pattern -->
              <div class="qr-inner"></div>
            </div>
          </div>
          <div class="qr-info">
            <p class="qr-text">{{ selectedCard?.qrCode }}</p>
            <p class="qr-hint">ูู ุจุชูุฌูู ุงููุงููุฑุง ูุญู ูุฐุง ุงูููุฏ</p>
          </div>
        </div>

        <div class="qr-details">
          <div class="detail-item">
            <span class="detail-label">ุฑูู ุงูุนุถููุฉ:</span>
            <!-- <span class="detail-value">CUST-{{ selectedCard?.qrCode?.split('-')[1] }}</span> -->
          </div>
          <div class="detail-item">
            <span class="detail-label">ุงูุญุงูุฉ:</span>
            <span class="detail-value status-active">ูุดุท</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">ุงูุบุณูุงุช ุงููุชุจููุฉ:</span>
            <!-- <span class="detail-value">{{ selectedCard?.washesRequired - (selectedCard?.washesCompleted || 0) }}</span> -->
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button (click)="copyQRCode()" class="modal-btn primary">
          <span class="btn-icon">๐</span>
          ูุณุฎ ุงูุฑูุฒ
        </button>
        <button (click)="shareQRCode()" class="modal-btn secondary">
          <span class="btn-icon">โ๏ธ</span>
          ูุดุงุฑูุฉ
        </button>
        <button (click)="downloadQR()" class="modal-btn outline">
          <span class="btn-icon">โฌ๏ธ</span>
          ุชุญููู
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุญุณุงุจู...</p>
    </div>
  </div>
</div>